---
title: Git
date: 2022-10-01 00:00:00 +0800
categories: [CS, Devel]
tags: [git]
---

**æ³¨æ„**ï¼š**è¯¯æ“ä½œ**gitéå¸¸å®¹æ˜“åˆ¶é€ ç¾éš¾ï¼Œå°½å¯èƒ½åœ¨æ“ä½œå‰ç†æ¸…ä»“åº“ç»“æ„ï¼Œç¡®å®šä»“åº“æƒ…å†µï¼Œé¢„æƒ³æ“ä½œå½±å“ã€‚

ä½¿ç”¨`git log --oneline --graph --all`, `git reflog`ç­‰å‘½ä»¤ï¼Œ
æˆ–è€…`tig --all`ç­‰å·¥å…·æ˜¾ç¤ºä»“åº“å›¾å½¢åŒ–ç»“æ„ï¼Œä»¥**é˜²æ­¢ç–å¿½å’Œé”™è¯¯ç†è§£**è€Œäº§ç”Ÿè¯¯æ“ä½œã€‚

- `gitignore`, `git hooks`éƒ¨åˆ†è§`ignore/README.md`, `hooks/README.md`
- `git server`éƒ¨åˆ†è§`cgit/README.md`

## Gitç”¨æˆ·é…ç½®

```sh
# gité…ç½®å¸®åŠ©
git config --help

# [å…¨å±€/å½“å‰]ä»“åº“é…ç½®ç”¨æˆ·åå’Œé‚®ç®±ğŸ“«
git config [--global] user.name "username"
git config [--global] user.email "useremail"

# [å…¨å±€/å½“å‰]ä»“åº“é»˜è®¤ç¼–è¾‘å™¨
git config [--global] core.editor vim
# [å…¨å±€/å½“å‰]ä»“åº“é»˜è®¤diffç¼–è¾‘å™¨
git config [--global] diff.tool vim # vimdiff/vscode/meld/...

# ç¼–è¾‘[å…¨å±€/å½“å‰]ä»“åº“é…ç½®æ–‡ä»¶
git config [--global] -e
```

## Gitç½‘ç»œä»£ç†

### é•œåƒç«™

```sh
# Mirrors ç½‘å€ä»…ä½œä¸¾ä¾‹ï¼Œå…·ä½“å¯ç”¨é•œåƒç«™åœ°å€æœç´¢å…³é”®è¯`github é•œåƒç«™`
https://xxx.gitxxx.xxx
# Git clone
git clone https://xxx.gitxxx.xxx/xxx/xxx.git
# Git config
git config --global url."https://xxx.gitxxx.xxx".insteadOf https://github.com
vi ~/.gitconfig
```

### ç§‘å­¦ä»£ç†

```sh
# å·²ç»é…ç½®å¥½socks5æˆ–å…¶ä»–ä»£ç†
# Terminal proxy
export http_proxy="http://127.0.0.1:1080"
export https_proxy="http://127.0.0.1:1080"
export all_proxy="socks5://127.0.0.1:1080"
# unset terminal proxy
unset http_proxy
unset https_proxy
unset all_proxy

# Git proxy
git config --global http.proxy 'socks5://127.0.0.1:1080'
git config --global https.proxy 'socks5://127.0.0.1:1080'

# Proxychains
sudo vi /etc/proxychains.conf # socks5 127.0.0.1 1080
proxychains git clone https://github.com/xxx/xxx.git
proxychains curl/wget -v xxx.com
```

## ä»“åº“

```sh
repo:
------ remote repository ------ ------ ------ ------ ------ ------ ------
|               ^                                       |               |
|clone          |push                                   |fetch          |pull(fetch+merge)
v               |                                       v               |reset --hard remote/branch
------ local repository ------ ------ ------ ------ ------              |
|               ^               |                       |               |
|checkout HEAD  |commit [-a]    |reset HEAD [filename]  |merge          |
|switch [-c]    |               v restore --staged      |reset --hard   |
|               --- staged/index ---                    |rebase         |
|               ^               |                       |revert         |
|               |add/mv/rm      |checkout filename      |cherry-pick    |
v               |               v restore filename      v               v
------ workspace ------ ------ ------ ------ ------ ------ ------ ------
|               ^
|stash          |stash apply/pop
v               |
------ stash ------

file:
------ staged ------
^       ^           |
|       |stage      |commit
|       |           |
| --- modified ---  |
|       ^           |
|       |edit       |
|       |           v
| --- unmodified ---
|       |
|add    |remove
|       v
------ untracked ------
```

### åˆ›å»ºä»“åº“

```sh
# åˆå§‹åŒ–ä»“åº“
git init
# åˆå§‹åŒ–è£¸ä»“åº“ï¼ˆæ²¡æœ‰å·¥ä½œåŒºæ–‡ä»¶çš„ä»“åº“ï¼Œä½œä¸ºä¸­å¿ƒä»“åº“ï¼‰
git init --bare
# å…‹éš†è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°
git clone git@git-server-ip:/path/to/repo.git
```

### æ·»åŠ æ–‡ä»¶åˆ°ä»“åº“

```sh
# æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº/ç´¢å¼•åŒº(staged/index)
# æ·»åŠ å•ä¸ªæ–‡ä»¶
git add
# æ·»åŠ æ‰€æœ‰æ–‡ä»¶
git add .
# ç¼–è¾‘.gitignoreè®¾ç½®ä¼šè¢«å¿½ç•¥çš„æ–‡ä»¶
vi .gitignore

# æäº¤åˆ°ä»“åº“
git commit -am "init repo"
# æŸ¥çœ‹å·¥ä½œåŒºçŠ¶æ€
git status [-bs]
# å¯¹æ¯”å·¥ä½œåŒºå’Œæš‚å­˜åŒº/ç´¢å¼•åŒº(staged/index)
git diff
# å¯¹æ¯”æš‚å­˜åŒº/ç´¢å¼•åŒº(staged/index)å’Œä¸Šæ¬¡æäº¤(repo)
git diff --staged
```

### å›é€€ç‰ˆæœ¬

```sh
# æŸ¥çœ‹è¿‡å»ç‰ˆæœ¬
git log
git log --pretty=oneline
# å›é€€ç‰ˆæœ¬
# å›é€€åˆ°å½“å‰æœ€æ–°æäº¤
git reset --hard HEAD
# å›é€€åˆ°ä¸Šæ¬¡æäº¤
git reset --hard HEAD^
# å›é€€åˆ°ä¸Šnæ¬¡æäº¤
git reset --hard HEAD~n
# å›é€€åˆ°æŸæ¬¡æäº¤
git reset --hard commitid
# æŸ¥çœ‹å†å²æäº¤åŠè¢«å›é€€çš„æäº¤
git reflog # ä»…é™æœ¬åœ°è®°å½•
```

### æ’¤é”€ä¿®æ”¹

```sh
# æ’¤é”€æ²¡æœ‰æäº¤åˆ°æš‚å­˜åŒº/ç´¢å¼•åŒº(staged/index)ï¼Œå³æ²¡æœ‰`git add`çš„ä¿®æ”¹
# ç”¨æš‚å­˜åŒº/ç´¢å¼•åŒºè¯¥æ–‡ä»¶çš„ä¿®æ”¹è®°å½•ï¼ˆå³æœ€åä¸€æ¬¡addåçš„è®°å½•ï¼‰è¦†ç›–å·¥ä½œåŒº
git checkout filename

# æ’¤é”€æäº¤åˆ°æš‚å­˜åŒº/ç´¢å¼•åŒºä½†æ˜¯æ²¡æœ‰æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå³æ²¡æœ‰`git commit`çš„ä¿®æ”¹
# ç”¨æœ¬åœ°ä»“åº“è¯¥æ–‡ä»¶çš„ä¿®æ”¹è®°å½•ï¼ˆå³æœ€åä¸€æ¬¡commitåçš„è®°å½•ï¼‰è¦†ç›–æš‚å­˜åŒº/ç´¢å¼•åŒº
git reset HEAD filename
# å†ç”¨æš‚å­˜åŒº/ç´¢å¼•åŒºè¯¥æ–‡ä»¶çš„ä¿®æ”¹è®°å½•ï¼ˆå³æœ€åä¸€æ¬¡commitåçš„è®°å½•ï¼‰è¦†ç›–å·¥ä½œåŒº
git checkout filename
# åˆå¹¶ä¸ºä¸€æ­¥
git reset HEAD --hard

# æ’¤é”€æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå³å·²ç»`git commit`çš„ä¿®æ”¹
# ç”¨æœ¬åœ°ä»“åº“è¯¥æ–‡ä»¶çš„ä¸Šæ¬¡ä¿®æ”¹è®°å½•ï¼ˆå³å€’æ•°ç¬¬äºŒæ¬¡commitåçš„è®°å½•ï¼‰è¦†ç›–æš‚å­˜åŒº/ç´¢å¼•åŒº
git reset HEAD^
# å†ç”¨æš‚å­˜åŒº/ç´¢å¼•åŒºè¯¥æ–‡ä»¶çš„ä¿®æ”¹è®°å½•ï¼ˆå³å€’æ•°ç¬¬äºŒæ¬¡commitåçš„è®°å½•ï¼‰è¦†ç›–å·¥ä½œåŒº
git checkout filename
# åˆå¹¶ä¸ºä¸€æ­¥
git reset HEAD^ --hard
```

### åˆ é™¤/é‡å‘½åæ–‡ä»¶

```sh
# ä»ä»“åº“åˆ é™¤æ–‡ä»¶ï¼Œæœ¬åœ°ä¹ŸåŒæ­¥åˆ é™¤æ–‡ä»¶
git rm filename

# ä»ä»“åº“åˆ é™¤æ–‡ä»¶ï¼Œä½†æœ¬åœ°ä¸åˆ é™¤æ–‡ä»¶
git rm --cached filename
git rm --cached -r dir/

# [é€’å½’å¼ºåˆ¶]åˆ é™¤å·¥ä½œåŒºæœªè¿½è¸ªçš„æ–‡ä»¶
git clean [-df]

# åˆ é™¤æœªæ·»åŠ .gitignoreå‰é”™è¯¯æäº¤çš„æ–‡ä»¶ï¼ˆåˆ é™¤é”™è¯¯æ–‡ä»¶é‡æ–°æäº¤ï¼‰
# å·²ç»è¢«ç®¡ç†çš„æ–‡ä»¶å³ä½¿è¢«åŠ å…¥äº†gitignoreä¹Ÿä¼šè¢«è¿½è¸ªï¼Œæ‰€ä»¥åªèƒ½ä»ä»“åº“åˆ é™¤é‡æ–°æäº¤
git rm --cached -r dir/ filename
git add .
git commit -am "delete all and use gitignore"

# é‡å‘½åæ–‡ä»¶æ–‡ä»¶å¤¹
git mv file-old-name file-new-name
```

### æŸ¥çœ‹æäº¤ä¿¡æ¯

```sh
git show HEAD
git show HEAD~1
git show HEAD~1:filename
```

## åˆ†æ”¯

æ¥æºï¼š[ğŸŒ³ğŸš€ CS Visualized: Useful Git Commands](https://dev.to/lydiahallie/cs-visualized-useful-git-commands-37p1)

```sh
Merge:
    `main$ git merge dev`: fast-forward(--ff)
    --- main ---    --- dev ---             --- main ---    --- dev ---
                    76d12                   76d12 <- [HEAD][main][dev]
                    |                       |
                    |                       v
    ec5be[HEAD] <---o           ==>         ec5be
    |                                       |
    v                                       v
    i8fe5                                   i8fe5

    `main$ git merge dev`: no-fast-forward(--no-ff)
    --- main ---    --- dev ---             --- main ---    --- dev ---
                                            9e78i[HEAD] ----o
                                            |               |
                                            v               v
    035cc[HEAD]     e3475                   035cc           e3475
    |               |           ==>         |               |
    v               v                       v               v
    ec5be           76d12                   ec5be           76d12
    |               |                       |               |
    v               |                       v               |
    i8fe5       <---o                       i8fe5       <---o

    merge conflicts:
    CONFLICT (content)
    Merge conflict in README.md
    `main$ vi README.md`
    `main$ git commit -a`

Rebase:
    `dev$ git rebase main`:
    --- main ---    --- dev ---             --- main ---    --- dev ---
                                                                3a2e2[HEAD]
                                                                |
                                                                v
                        e3475[HEAD]                             e45cb
                        |                                       |
                        v                                       |
    ec5be               76d12                   ec5be       <---o
    |                   |                       |
    v                   |                       v
    i8fe5           <---o                       i8fe5

    `main$ git rebase -i HEAD~3`:
    --- main ---    --- main ---
    3a2e2[HEAD]
    |
    v
    e45cb               9ae53[HEAD]
    |                   |
    v           ==>     v
    ec5be               c4ec9
    |                   |
    v                   v
    i8fe5               i8fe5

Reset:
    `main$ git reset --soft HEAD~2`:
    --- main ---    --- main ---
    3a2e2[HEAD]         3a2e2
    |                   |
    v                   v
    e45cb               e45cb
    |                   |
    v           ==>     v
    ec5be               ec5be[HEAD]
    |                   |
    v                   v
    i8fe5               i8fe5

    `main$ git reset --hard HEAD~2`:
    --- main ---    --- main ---
    3a2e2[HEAD]
    |
    v
    e45cb
    |
    v           ==>
    ec5be               ec5be[HEAD]
    |                   |
    v                   v
    i8fe5               i8fe5

Revert:
    `dev$ git revert ec5be`:
    --- dev ---         --- dev ---
                        9e78i[HEAD](-README.md)
                        |
                        v
    035cc[HEAD]         035cc
    |                   |
    v                   v
    ec5be(+README.md)   ec5be(+README.md)
    |                   |
    v                   v
    i8fe5               i8fe5

Cherry-pick:
    `main$ git cherry-pick 76d12`
    --- main ---    --- dev ---             --- main ---    --- dev ---
                                            9e78i[HEAD](+README.md)
                                            |
                                            v
    035cc[HEAD]     76d12(+README.md)       035cc[HEAD]     76d12(+README.md)
    |               |               ==>     |               |
    v               v                       v               v
    035cd           89u7e                   035cd           89u7e
    |               |                       |               |
    v               |                       v               |
    i8fe5       <---o                       i8fe5       <---o

Fetch:
    `main$ git fetch`:
    --- main ---    --- remote ---              --- main ---    --- remote ---
                    7e456[origin/master]        7e456           7e456[origin/master]
                    |                           |               |
                    v                           v               v
                    efi81                       efi81           efi81
                    |               ==>         |               |
                    v                           v               v
    035cc[HEAD]     035cc                       035cc[HEAD]     035cc
    |               |                           |               |
    v               v                           v               v
    i8fe5           i8fe5                       i8fe5           i8fe5

Pull:
    pull = fetch + merge
```

### åˆ›å»ºåˆå¹¶åˆ†æ”¯

```sh
# åˆ›å»ºæœ¬åœ°åˆ†æ”¯
git branch branch-name
# åˆ›å»ºå¹¶åˆ‡æ¢æœ¬åœ°åˆ†æ”¯
git checkout -b branch-name
# åˆ‡æ¢åˆ†æ”¯
git checkout branch-name
# åˆå¹¶åˆ†æ”¯ [åˆå¹¶åˆ†æ”¯æ—¶ç¦ç”¨fast forward]
git merge [--no-ff] branch-name
```

### æŸ¥çœ‹åˆ é™¤åˆ†æ”¯

```sh
# æŸ¥çœ‹å½“å‰åˆ†æ”¯
git branch
# æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ï¼ˆæœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ï¼‰
git branch -a
# æŸ¥çœ‹åˆ†æ”¯çŠ¶æ€
git log --graph --oneline
# åˆ é™¤æœ¬åœ°æœªåˆå¹¶åˆ†æ”¯
git branch -D branch-name
# åˆ é™¤æœ¬åœ°å·²åˆå¹¶åˆ†æ”¯
git branch -d branch-name
# åˆ é™¤è¿œç¨‹åˆ†æ”¯
git push origin -d branch-name
git push repo-name -d branch-name
```

### æš‚å­˜ä¿®æ”¹

```sh
# æš‚å­˜å·¥ä½œç°åœº
git stash
# æ¢å¤å·¥ä½œç°åœº
git stash apply     # æ¢å¤
git stash drop      # åˆ é™¤
git stash pop       # æ¢å¤åˆ é™¤
```

### ç‰ˆæœ¬æ ‡ç­¾Tag

```sh
# Tag ä»…å¯è¯»çš„branch
# æŸ¥çœ‹æœ¬åœ°Tag[è¿œç¨‹Tag]
git tag [-r]
# æ·»åŠ Tag
git tag tagname [commitid]
# åˆ é™¤æœ¬åœ°Tag
git tag -d tagname
# åˆ é™¤è¿œç¨‹Tag
git push origin -d tagname
# æ¨é€Tagåˆ°è¿œç¨‹ä»“åº“
git push origin tagname
git push origin --tags
# æ›´æ–°Tagåˆ°æœ¬åœ°
git pull origin --tags
```

## åä½œğŸŒ¿

```sh
# æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯
git remote -v
# æ›´æ–°è¿œç¨‹åº“
git fetch
# å°†è¿œç¨‹åº“æœ€æ–°ä¿®æ”¹æ›´æ–°åˆ°æœ¬åœ°
git pull # git fetch + git merge
# å°†æœ¬åœ°ä¿®æ”¹æ¨é€åˆ°è¿œç¨‹åº“
git push [origin branch-name]
# ä½¿ç”¨è¿œç¨‹åˆ†æ”¯Aåˆ›å»ºæœ¬åœ°åˆ†æ”¯
git checkout -b A origin/A # originæ˜¯è¿œç¨‹ä»“åº“å
# å°†æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯å…³è”
git branch --set-upstream A origin/A
```

å‚è€ƒé“¾æ¥ï¼š
[Kernelæäº¤è§„èŒƒ](https://docs.kernel.org/process/submitting-patches.html#describe-your-changes)
[emacsæäº¤è§„èŒƒ](https://github.com/emacs-mirror/emacs/blob/master/CONTRIBUTE#L171)
[æäº¤è§„èŒƒ](https://www.conventionalcommits.org/)
[Git Emoji](https://gitmoji.dev/)

~~æäº¤ä¿¡æ¯ä¸å¡«`.`å°±æ˜¯èƒœåˆ©ï¼~~

## Gitå¸¸è§é—®é¢˜

æ¥æºï¼š<https://ohshitgit.com>

### å™¢ï¼Œç³Ÿäº†ï¼Œæˆ‘åˆšæ‰å¥½åƒçŠ¯äº†ä¸ªå¤§é”™ï¼Œèƒ½ä¸èƒ½ç»™æˆ‘å°æ—¶å…‰æœºå•Š!?

```sh
git reflog
# ä½ å°†çœ‹åˆ°ä½ åœ¨ git ä¸Šæäº¤çš„æ‰€æœ‰æ”¹åŠ¨è®°å½•è¢«åˆ—
# äº†å‡ºæ¥ï¼Œè€Œä¸”å›Šæ‹¬äº†æ‰€æœ‰çš„åˆ†æ”¯ï¼Œå’Œå·²è¢«åˆ é™¤çš„
# commit å“¦ï¼
# æ¯ä¸€æ¡è®°å½•éƒ½æœ‰ä¸€ä¸ªç±»ä¼¼ HEAD@{index} çš„ç´¢
# å¼•ç¼–å·
# æ‰¾åˆ°åœ¨çŠ¯é”™å‰çš„é‚£ä¸ªæäº¤è®°å½•çš„ç´¢å¼•å·ï¼Œç„¶åæ‰§
# è¡Œï¼š
git reset HEAD@{index}
# å“ˆå“ˆï¼Œè¿™å°±æ˜¯ä½ è¦çš„æ—¶å…‰æœºï¼
```

ä½ å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥æ‰¾å›é‚£äº›ä½ ä¸å°å¿ƒåˆ é™¤çš„ä¸œè¥¿ã€æ¢å¤ä¸€äº›ä½ å¯¹ repo æ”¹åŠ¨ã€æ¢å¤ä¸€æ¬¡é”™è¯¯çš„ merge æ“ä½œã€æˆ–è€…ä»…ä»…æƒ³é€€å›åˆ°ä½ çš„é¡¹ç›®è¿˜èƒ½æ­£å¸¸å·¥ä½œçš„é‚£ä¸€æ—¶åˆ»ã€‚æˆ‘ç»å¸¸ä½¿ç”¨ reflogï¼Œåœ¨æ­¤æˆ‘è¦å‘é‚£äº›ææ¡ˆæ·»åŠ è¿™ä¸ªåŠŸèƒ½çš„äººä»¬è¡¨ç¤ºæ„Ÿè°¢ï¼Œå¤ªè°¢è°¢ä»–ä»¬äº†ï¼

### å™¢ï¼Œç³Ÿäº†ï¼Œæˆ‘åˆšæäº¤ commit å°±å‘ç°è¿˜æœ‰ä¸€ä¸ªå°æ”¹åŠ¨éœ€è¦æ·»åŠ 

```sh
# ç»§ç»­æ”¹åŠ¨ä½ çš„æ–‡ä»¶
git add . # æˆ–è€…ä½ å¯ä»¥æ·»åŠ æŒ‡å®šçš„æ–‡ä»¶
git commit --amend --no-edit
# ä½ è¿™æ¬¡çš„æ”¹åŠ¨ä¼šè¢«æ·»åŠ è¿›æœ€è¿‘ä¸€æ¬¡çš„ commit ä¸­
# è­¦å‘Š: åƒä¸‡åˆ«å¯¹å…¬å…±çš„ commit åšè¿™ç§æ“ä½œ
```

è¿™ç»å¸¸å‘ç”Ÿåœ¨æˆ‘æäº¤äº† commit ä»¥åç«‹é©¬å‘ç°ï¼Œå“å‘€ï¼Œæˆ‘å¿˜äº†åœ¨æŸä¸ªç­‰å·åé¢åŠ ç©ºæ ¼äº†ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æäº¤ä¸€ä¸ªæ–°çš„ commit ç„¶ååˆ©ç”¨ rebase -i å‘½ä»¤æ¥åˆå¹¶å®ƒä»¬ï¼Œä½†æˆ‘è§‰å¾—æˆ‘çš„è¿™ç§æ–¹å¼æ¯”ä½ å¿« 100 ä¸‡å€ã€‚

è­¦å‘Š: ä½ åƒä¸‡ä¸è¦åœ¨å·²æ¨é€çš„å…¬å…±åˆ†æ”¯ä¸Šåšè¿™ä¸ª amend çš„æ“ä½œ! åªèƒ½åœ¨ä½ æœ¬åœ° commit ä¸Šåšè¿™ç§ä¿®æ”¹ï¼Œå¦åˆ™ä½ ä¼šæŠŠäº‹æƒ…æç ¸çš„ï¼

### å™¢ï¼Œç³Ÿäº†ï¼Œæˆ‘è¦ä¿®æ”¹æˆ‘åˆšåˆš commit æäº¤çš„ä¿¡æ¯

```sh
git commit --amend
# æŒ‰ç…§æç¤ºä¿®æ”¹ä¿¡æ¯å°±è¡Œå•¦
```

ä½¿ç”¨ç¹ççš„æäº¤ä¿¡æ¯æ ¼å¼

### å™¢ï¼Œç³Ÿäº†ï¼Œæˆ‘ä¸å°å¿ƒæŠŠæœ¬åº”åœ¨æ–°åˆ†æ”¯ä¸Šæäº¤çš„ä¸œè¥¿æäº¤åˆ°äº† master

```sh
# åŸºäºå½“å‰ master æ–°å»ºä¸€ä¸ªåˆ†æ”¯
git branch some-new-branch-name
# åœ¨ master ä¸Šåˆ é™¤æœ€è¿‘çš„é‚£æ¬¡ commit
git reset HEAD~ --hard
git checkout some-new-branch-name
# åªæœ‰åœ¨è¿™ä¸ªæ–°åˆ†æ”¯ä¸Šæ‰æœ‰ä½ æœ€è¿‘çš„é‚£æ¬¡ commit å“¦
```

æ³¨æ„ï¼šå¦‚æœä½ å·²å°†è¿™ä¸ª commit æ¨é€åˆ°äº†å…¬å…±åˆ†æ”¯ï¼Œé‚£è¿™æ³¢æ“ä½œå°±ä¸èµ·ä½œç”¨äº†ã€‚å¦‚æœä½ åœ¨æ­¤ä¹‹å‰åšäº†äº›å…¶ä»–çš„æ“ä½œï¼Œé‚£ä½ å¯èƒ½éœ€è¦ä½¿ç”¨ HEAD@{number-of-commits-back} æ¥æ›¿ä»£ HEAD~ã€‚å¦å¤–ï¼Œæ„Ÿè°¢å¾ˆå¤šäººæå‡ºäº†è¿™ä¸ªæˆ‘è‡ªå·±éƒ½ä¸çŸ¥é“çš„è¶…æ£’çš„è§£å†³æ–¹æ³•ï¼Œè°¢è°¢å¤§å®¶ï¼

### å™¢ï¼Œç³Ÿäº†ï¼Œæˆ‘æŠŠè¿™ä¸ª commit æäº¤é”™åˆ†æ”¯äº†

```sh
# æ’¤å›è¿™æ¬¡æäº¤ï¼Œä½†ä¿ç•™æ”¹åŠ¨çš„å†…å®¹
git reset HEAD~ --soft
git stash
# ç°åœ¨åˆ‡åˆ°æ­£ç¡®çš„é‚£ä¸ªåˆ†æ”¯å»
git checkout name-of-the-correct-branch
git stash pop
git add . # æˆ–è€…ä½ å¯ä»¥æ·»åŠ æŒ‡å®šçš„æ–‡ä»¶
git commit -m "your message here";
# ç°åœ¨ä½ çš„æ”¹åŠ¨å°±åœ¨æ­£ç¡®çš„åˆ†æ”¯ä¸Šå•¦
```

å¾ˆå¤šäººå»ºè®®ä½¿ç”¨ cherry-pick æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®ä¸¤è€…éƒ½å¯ä»¥ï¼Œä½ åªè¦é€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ–¹å¼å°±è¡Œäº†ã€‚

```sh
git checkout name-of-the-correct-branch
# æŠ“å– master åˆ†æ”¯ä¸Šæœ€æ–°çš„é‚£ä¸ª commit
git cherry-pick master
# ç„¶ååˆ æ‰ master ä¸Šçš„é‚£ä¸ª commit
git checkout master
git reset HEAD~ --hard
```

### å™¢ï¼Œç³Ÿäº†ï¼Œæˆ‘æƒ³ç”¨ diff å‘½ä»¤çœ‹ä¸‹æ”¹åŠ¨å†…å®¹ï¼Œä½†å•¥éƒ½æ²¡çœ‹åˆ°?

å¦‚æœå¯¹æ–‡ä»¶åšäº†æ”¹åŠ¨ï¼Œä½†æ˜¯é€šè¿‡ diff å‘½ä»¤å´çœ‹ä¸åˆ°ï¼Œé‚£å¾ˆå¯èƒ½æ˜¯ä½ æ‰§è¡Œè¿‡ add å‘½ä»¤å°†æ–‡ä»¶æ”¹åŠ¨æ·»åŠ åˆ°äº† æš‚å­˜åŒº äº†ã€‚ä½ éœ€è¦æ·»åŠ ä¸‹é¢è¿™ä¸ªå‚æ•°ã€‚

```sh
git diff --staged
```

è¿™äº›æ–‡ä»¶åœ¨è¿™é‡Œ (ãƒ„) (æ˜¯çš„ï¼Œæˆ‘çŸ¥é“è¿™æ˜¯ä¸€ä¸ª feature è€Œä¸æ˜¯ bugï¼Œä½†å®ƒç¬¬ä¸€æ¬¡å‘ç”Ÿåœ¨ä½œä¸ºåˆå­¦è€…çš„ä½ èº«ä¸Šæ—¶ï¼ŒçœŸçš„å¾ˆè®©äººå›°æƒ‘ï¼)

### å™¢ï¼Œç³Ÿäº†ï¼Œæˆ‘æƒ³æ’¤å›ä¸€ä¸ªå¾ˆæ—©ä»¥å‰çš„ commit

```sh
# å…ˆæ‰¾åˆ°ä½ æƒ³æ’¤é”€çš„é‚£ä¸ª commit
git log
# å¦‚æœåœ¨ç¬¬ä¸€å±æ²¡æ‰¾åˆ°ä½ éœ€è¦çš„é‚£ä¸ª commitï¼Œå¯ä»¥ç”¨ä¸Šä¸‹
# ç®­å¤´æ¥æ»šåŠ¨æ˜¾ç¤ºçš„å†…å®¹ï¼Œæ‰¾åˆ°äº†ä»¥åè®°ä¸‹ commit çš„
# hash å€¼
git revert [åˆšæ‰è®°ä¸‹çš„é‚£ä¸ª hash å€¼]
# git ä¼šè‡ªåŠ¨ä¿®æ”¹æ–‡ä»¶æ¥æŠµæ¶ˆé‚£æ¬¡ commit çš„æ”¹åŠ¨ï¼Œå¹¶åˆ›
# å»ºä¸€ä¸ªæ–°çš„ commitï¼Œä½ å¯ä»¥æ ¹æ®æç¤ºä¿®æ”¹è¿™ä¸ªæ–° commit
# çš„ä¿¡æ¯ï¼Œæˆ–è€…ç›´æ¥ä¿å­˜å°±å®Œäº‹äº†
```

è¿™æ ·ä½ å°±ä¸éœ€è¦ç”¨å›æº¯è€ç‰ˆæœ¬ç„¶åå†å¤åˆ¶ç²˜è´´çš„æ–¹å¼äº†ï¼Œé‚£æ ·åšå¤ªè´¹äº‹äº†ï¼å¦‚æœä½ æäº¤çš„æŸä¸ª commit å¯¼è‡´äº† bugï¼Œä½ ç›´æ¥ç”¨ revert å‘½ä»¤æ¥æ’¤å›é‚£æ¬¡æäº¤å°±è¡Œå•¦ã€‚

ä½ ç”šè‡³å¯ä»¥æ¢å¤å•ä¸ªæ–‡ä»¶è€Œä¸æ˜¯ä¸€æ•´ä¸ª commitï¼ä½†é‚£æ˜¯å¦ä¸€å¥— git å‘½ä»¤å’¯...

### å™¢ï¼Œç³Ÿäº†ï¼Œæˆ‘æƒ³æ’¤å›æŸä¸€ä¸ªæ–‡ä»¶çš„æ”¹åŠ¨

```sh
# æ‰¾åˆ°æ–‡ä»¶æ”¹åŠ¨å‰çš„é‚£ä¸ª commit
git log
# å¦‚æœåœ¨ç¬¬ä¸€å±æ²¡æ‰¾åˆ°ä½ éœ€è¦çš„é‚£ä¸ª commitï¼Œå¯ä»¥ç”¨ä¸Šä¸‹
# ç®­å¤´æ¥æ»šåŠ¨æ˜¾ç¤ºçš„å†…å®¹ï¼Œæ‰¾åˆ°äº†ä»¥åè®°ä¸‹ commit çš„
# hash å€¼
git checkout [åˆšæ‰è®°ä¸‹çš„é‚£ä¸ª hash å€¼] -- path/to/file
# æ”¹åŠ¨å‰çš„æ–‡ä»¶ä¼šä¿å­˜åˆ°ä½ çš„æš‚å­˜åŒº
git commit -m "è¿™æ ·å°±ä¸éœ€è¦é€šè¿‡å¤åˆ¶ç²˜è´´æ¥æ’¤å›æ”¹åŠ¨å•¦"
```

æˆ‘èŠ±äº†å¥½é•¿å¥½é•¿æ—¶é—´æ‰ææ˜ç™½è¦è¿™ä¹ˆåšã€‚è¯´çœŸçš„ï¼Œç”¨ checkout -- æ¥æ’¤å›ä¸€ä¸ªæ–‡ä»¶çš„æ”¹åŠ¨ï¼Œè¿™çœŸæ˜¯å¤ªå¥‡è‘©äº†?! :å‘ Linus Torvalds æ‘†å‡ºæŠ—è®®å§¿åŠ¿:

### è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„æ–‡ä»¶å¤ªçƒ¦äººäº†, æˆ‘æ”¾å¼ƒå•¦ã€‚ï¼ˆé‚£äº› untracked çš„æ–‡ä»¶ï¼‰

```sh
cd ..
sudo rm -r fucking-git-repo-dir
git clone https://some.github.url/fucking-git-repo-dir.git
cd fucking-git-repo-dir
```

æ„Ÿè°¢ Eric V. æä¾›äº†è¿™ä¸ªäº‹ä¾‹ï¼Œå¦‚æœå¯¹ sudo çš„ä½¿ç”¨æœ‰ä»€ä¹ˆçš„è´¨ç–‘çš„è¯ï¼Œå¯ä»¥å»å‘ä»–æå‡ºã€‚

ä¸è¿‡è¯´çœŸçš„ï¼Œå¦‚æœä½ çš„åˆ†æ”¯çœŸçš„è¿™ä¹ˆç³Ÿç³•çš„è¯ï¼Œä½ åº”è¯¥ä½¿ç”¨ "git-approved" çš„æ–¹æ³•æ¥é‡ç½®ä½ çš„ repoï¼Œå¯ä»¥è¯•è¯•è¿™ä¹ˆåšï¼Œä½†è¦æ³¨æ„è¿™äº›æ“ä½œéƒ½æ˜¯ç ´åæ€§çš„ï¼Œä¸å¯é€†çš„ï¼

```sh
# è·å–è¿œç«¯åº“æœ€æ–°çš„çŠ¶æ€
git fetch origin
git checkout master
git reset --hard origin/master
# åˆ é™¤ untracked çš„æ–‡ä»¶å’Œç›®å½•
git clean -d --force
# å¯¹æ¯ä¸€ä¸ªæœ‰é—®é¢˜çš„åˆ†æ”¯é‡å¤ä¸Šè¿° checkout/reset/clean æ“ä½œ
```

**å…è´£å£°æ˜: æœ¬ç½‘ç«™å¹¶ä¸æ˜¯ä¸€ä¸ªè¯¦å°½å®Œæ•´çš„å‚è€ƒæ–‡æ¡£ã€‚å½“ç„¶ï¼Œæˆ‘çŸ¥é“è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ›´ä¼˜é›…çš„æ–¹æ³•èƒ½è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼Œä½†æˆ‘æ˜¯é€šè¿‡ä¸æ–­çš„å°è¯•ã€ä¸åœçš„åæ§½æœ€ç»ˆè§£å†³äº†è¿™äº›é—®é¢˜ã€‚æ¥ç€æˆ‘å°±æœ‰äº†è¿™ä¸ªå¥‡å¦™çš„æƒ³æ³•ï¼Œé€šè¿‡è¿™æ ·æ–¹å¼ï¼Œä½¿ç”¨ä¸€äº›ç™½è¯æ¥åˆ†äº«æˆ‘çš„ç»å†å’Œå‘ç°ã€‚ å¸Œæœ›ä½ ä¹Ÿè§‰å¾—è¿™å¾ˆæœ‰æ„æ€ï¼Œä½†å¦‚æœä½ ä¸èƒ½æ¥å—çš„è¯è¯·ç§»æ­¥åˆ«å¤„ã€‚**
